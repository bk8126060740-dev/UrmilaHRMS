<div class="dashborad-main payment-report">
    <div class="container-fulid p-0">
        <div class="row">
            <div class="col-12">
                <app-breadcrumb></app-breadcrumb>
            </div>
        </div>
        <div class="row m-0 mt-3 ">
            <div class="col p-0 m-0">
                <div class="main-board-1 pb-0 position-relative z-9">
                    <div
                        class="borad-header-create pb-3 pt-3 border-bottom d-flex justify-content-between position-sticky top-0 align-items-center cursor-pointer">
                        <p class="board-title">BANK UTR SHEET</p>

                    </div>
                    <div class="borad-body p-4">
                        <!-- Form Details -->
                        <form [formGroup]="bankSheetListForm">
                            <div class="row gy-3">
                                <div class="col-xl col-lg-6 col-12">
                                    <ng-select [items]="clientList" bindLabel="text" bindValue="value"
                                        [class.ng-select-unselected]="isViewMode && bankSheetListForm.controls['selectedClientId'].errors"
                                        formControlName="selectedClientId" (change)="onClientChange()"
                                        [clearable]="false" placeholder="Search & Select Client *" required>
                                    </ng-select>
                                </div>
                                <div class="col-xl-4 col-lg-6 col-12">
                                    <ng-select [items]="projectList" bindLabel="name" bindValue="id"
                                        [class.ng-select-unselected]="isViewMode && bankSheetListForm.controls['selectedProjectId'].errors"
                                        (change)="onProjectChange()" formControlName="selectedProjectId"
                                        [clearable]="false" [multiple]="false" placeholder="Search & Select Project *"
                                        required>
                                    </ng-select>
                                </div>
                            </div>
                            <div class="row gy-4 mt-1">
                                <div class="col-xl-3 col-lg-6 col-12">
                                    <ng-select [items]="payrollList" bindLabel="displayName" bindValue="id"
                                        [class.ng-select-unselected]="isViewMode && bankSheetListForm.controls['selectedPayrollId'].errors"
                                        formControlName="selectedPayrollId" [multiple]="false" [clearable]="false"
                                        placeholder="Search & Select Payroll *" required>
                                    </ng-select>
                                </div>
                                <div class="col-xl-3 col-lg-6 col-12">
                                    <ng-select [items]="bankList" bindLabel="bankName" bindValue="id"
                                        [class.ng-select-unselected]="isViewMode && bankSheetListForm.controls['selectedBankId'].errors"
                                        formControlName="selectedBankId" [multiple]="false" [clearable]="false"
                                        placeholder="Select Source Bank *" required>
                                    </ng-select>
                                </div>
                                <div class="col-xl-3 col-lg-6 col-12">
                                    <ng-select [items]="attributeArray" bindLabel="payrollAttributeName"
                                        bindValue="payrollAttributeId"
                                        [class.ng-select-unselected]="isViewMode && bankSheetListForm.controls['selectedPayrollAttributeId'].errors"
                                        formControlName="selectedPayrollAttributeId" [multiple]="false"
                                        [clearable]="false" placeholder="Select Payroll Attribute *" required>
                                    </ng-select>
                                </div>
                                <div class="col-xl-3 col-lg-6 col-12 header-btns">
                                    <div class="row gy-3">
                                        <div class="col-12 col-md-6">
                                            <button (click)="downloadOldBankTransferSheet()"
                                                class="btn btn-light w-100 d-flex gap-2 justify-content-center align-items-center">
                                                <icon-ExportBtn></icon-ExportBtn>
                                                Export Report
                                            </button>
                                        </div>
                                        <div class="col-12 col-md-6">
                                            <button (click)="viewDetails()"
                                                class="btn btn-save hover-none w-100 d-flex gap-2 justify-content-center align-items-center">
                                                <icon-filter></icon-filter>
                                                View Details
                                            </button>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </form>
                    </div>
                </div>
            </div>
        </div>


        <div class="row m-0 px-0">
            <div class="dashborad-main m-4 mx-0 mt-3 p-0 mb-0 pfdashborad">
                <div class="container-fluid">

                    <div class="row p-0">
                        <div class="col borad-parent p-0">
                            <div class="main-board-1 position-static px-0">
                                <div class="board-content position-relative h-100 flex-wrap">
                                    <div class="board-header d-flex justify-content-between px-4 py-3 flex-wrap">
                                        <div class="board-title d-flex align-items-center">
                                            Bank UTR Sheet
                                        </div>
                                    </div>
                                    <div class="parent-container">
                                        <div class="user-data table-responsive-container  overflow-auto">
                                            <table class="table mb-0" style="table-layout: fixed;">
                                                <thead class="position-sticky top-0 bg-white"
                                                    style="z-index: 2 !important; ">
                                                    <tr class="table-header-row table-title">
                                                        <th class="fw-semibold" style="width: 200px;">Payroll Name</th>
                                                        <th class="fw-semibold" style="width: 120px;">Month-Year</th>
                                                        <th class="fw-semibold" style="width: 120px;">Bank Name</th>
                                                        <th class="fw-semibold" style="width: 120px;">Payroll Attribute
                                                        </th>
                                                        <th class="fw-semibold" style="width: 120px;">Status</th>
                                                        <th class="fw-semibold text-center" style="width: 120px;">
                                                            Re-Download</th>
                                                        <th class="fw-semibold text-center" style="width: 120px;">Upload
                                                        </th>
                                                        <th class="fw-semibold text-center" style="width: 120px;">
                                                            ViewRecord</th>
                                                        <th class="fw-semibold text-center" style="width: 120px;">Error
                                                        </th>
                                                        <th class="fw-semibold text-center" style="width: 120px;">Action
                                                        </th>
                                                    </tr>
                                                </thead>
                                                <tbody>
                                                    <tr *ngFor="let item of salarySheetList">
                                                        <td>{{item.payrollName}}</td>
                                                        <td>{{item.month}}</td>
                                                        <td>{{item.bankResources}}</td>
                                                        <td>{{item.payrollAttributeName}}</td>
                                                        <td>
                                                            <div class="status-btn text-center position-relative overflow-hidden"
                                                                style="z-index: 1;">
                                                                <p style="z-index: 4; " [ngStyle]="{
                                                                    'color': item.colorCode
                                                                }">
                                                                    {{item.statusName}}
                                                                </p>
                                                                <span
                                                                    class="position-absolute top-0 left-0 h-100 w-100 card-status-opacity"
                                                                    style="z-index:1; "
                                                                    [ngStyle]="{'background-color': item.colorCode}">
                                                                </span>
                                                            </div>
                                                        </td>

                                                        <td>
                                                            <div class="attributes-icon d-flex justify-content-center align-items-center uploaded-y cursor ms-auto me-auto"
                                                                (click)="reDownloadbankSheet(item)"
                                                                style="width: fit-content;" mat-raised-button
                                                                matTooltip="Re-Download" [matTooltipPosition]="'right'"
                                                                [matTooltipShowDelay]="showDelay.value"
                                                                [matTooltipHideDelay]="hideDelay.value"
                                                                aria-label="Upload">
                                                                <span class="icn-bg bg-skyblue">
                                                                    <icon-Regenrate></icon-Regenrate>
                                                                </span>
                                                            </div>
                                                        </td>

                                                        <td>
                                                            <div class="attributes-icon d-flex justify-content-center align-items-center uploaded-y cursor ms-auto me-auto"
                                                                style="width: fit-content;" mat-raised-button
                                                                *ngIf="item.status === 589" (click)="openUTRModal(item)"
                                                                matTooltip="Upload" [matTooltipPosition]="'right'"
                                                                [matTooltipShowDelay]="showDelay.value"
                                                                [matTooltipHideDelay]="hideDelay.value"
                                                                aria-label="Upload">
                                                                <span class="icn-bg bg-skyblue">
                                                                    <icon-FileUpload></icon-FileUpload>
                                                                </span>
                                                            </div>
                                                        </td>
                                                        <td>
                                                            <div class="attributes-icon d-flex justify-content-center align-items-center uploaded-y cursor ms-auto me-auto"
                                                                style="width: fit-content;" mat-raised-button
                                                                *ngIf="item.status === 592" (click)="viewRecord(item)"
                                                                matTooltip="View Record" [matTooltipPosition]="'right'"
                                                                [matTooltipShowDelay]="showDelay.value"
                                                                [matTooltipHideDelay]="hideDelay.value"
                                                                aria-label="Upload">
                                                                <span class="icn-bg bg-green">
                                                                    <icon-pfChallan></icon-pfChallan>
                                                                </span>
                                                            </div>
                                                        </td>
                                                        <td>
                                                            <div class="attributes-icon d-flex justify-content-center align-items-center uploaded-y cursor ms-auto me-auto"
                                                                style="width: fit-content;" mat-raised-button
                                                                *ngIf="item.status === 593" matTooltip="View Record"
                                                                [matTooltipPosition]="'right'"
                                                                [matTooltipShowDelay]="showDelay.value"
                                                                [matTooltipHideDelay]="hideDelay.value"
                                                                aria-label="Upload">
                                                                <span class="icn-bg bg-green">
                                                                    <icon-fileDownload></icon-fileDownload>
                                                                </span>
                                                            </div>
                                                        </td>
                                                        <td>
                                                            <a class="attributes-icon d-flex justify-content-center align-items-center uploaded-y cursor ms-auto me-auto"
                                                                style="width: fit-content;" mat-raised-button
                                                                [href]="item.errorFilePath" download
                                                                *ngIf="item.status === 589" matTooltip="Delete"
                                                                [matTooltipPosition]="'right'"
                                                                [matTooltipShowDelay]="showDelay.value"
                                                                [matTooltipHideDelay]="hideDelay.value">
                                                                <span class="icn-bg bg-red">
                                                                    <icon-delete></icon-delete>
                                                                </span>
                                                            </a>
                                                        </td>
                                                    </tr>

                                                </tbody>
                                            </table>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

        </div>
    </div>
</div>


<div bsModal #UTRModal="bs-modal" class="modal" tabindex="-1" role="dialog" [config]="{backdrop: 'static'}">
    <div class="modal-dialog popup-design pf-challan">
        <div class="modal-content px-4 ">
            <div class="modal-header popup-header justify-content-between d-flex">
                <h5 class="modal-title pt-2" id="exampleModalLabel">UTR Upload</h5>
                <span class="d-block" (click)="closeUTRModal()">
                    <icon-ModalClose></icon-ModalClose>
                </span>
            </div>
            <div class="row align-items-center justify-content-center g-4 p-0 m-0">
                <div class="col-12">
                    <form [formGroup]="UTRForm">
                        <div class="row mt-3">
                            <div class="col-12 mb-3">
                                <p>Upload Document :</p>
                            </div>
                            <div class="col-12 col-md-6 col-lg-3 ">
                                <p class="text-secondary browse-file-title">TXT.file</p>
                                <div class="mt-2">
                                    <div class="browse-file position-relative"
                                        [class.browse-file-error]="isUploadSubmitted && UTRForm.controls['txtFile'].errors">
                                        <ng-container *ngIf="!UTRForm.controls['txtFile'].value">
                                            <div class="d-flex justify-content-center align-items-center w-100">
                                                <icon-AddAttch></icon-AddAttch>
                                            </div>
                                            <div class="mt-2 w-100">
                                                <p>Drag & Drop Upload File</p>
                                            </div>
                                            <div class="mt-2">
                                                <button class="btn-browse">Browse File</button>
                                            </div>
                                            <input type="file" (change)="onFileChange($event, 'txtFile')" accept=".txt"
                                                class="position-absolute top-0 left-0 h-100 w-100 opacity-0">
                                        </ng-container>
                                        <ng-container *ngIf=" UTRForm.controls['txtFile'].value">
                                            <div class="d-flex justify-content-center align-items-center w-100">
                                                <icon-TextFile></icon-TextFile>
                                            </div>
                                            <div class="mt-2 w-100 selected-file-name">
                                                <p>{{ UTRForm.controls['txtFile'].value.name }}</p>
                                            </div>
                                            <div class="mt-2">
                                                <button class="btn-browse" (click)="clearFile('txtFile')">Clear</button>
                                            </div>
                                        </ng-container>
                                    </div>
                                </div>
                            </div>
                            <div class="col-12 col-md-6 col-lg-3 ">
                                <p class="text-secondary browse-file-title">Excel / CSV File</p>
                                <div class="mt-2">
                                    <div class="browse-file position-relative"
                                        [class.browse-file-error]="isUploadSubmitted && UTRForm.controls['excelFile'].errors">
                                        <ng-container *ngIf="!UTRForm.controls['excelFile'].value">
                                            <div class="d-flex justify-content-center align-items-center w-100">
                                                <icon-AddAttch></icon-AddAttch>
                                            </div>
                                            <div class="mt-2 w-100">
                                                <p>Drag & Drop Upload File</p>
                                            </div>
                                            <div class="mt-2">
                                                <button class="btn-browse">Browse File</button>
                                            </div>
                                            <input type="file" (change)="onFileChange($event, 'excelFile')"
                                                accept=".xlsx,.csv"
                                                class="position-absolute top-0 left-0 h-100 w-100 opacity-0">
                                        </ng-container>
                                        <ng-container *ngIf=" UTRForm.controls['excelFile'].value">
                                            <div class="d-flex justify-content-center align-items-center w-100">
                                                <icon-TextFile></icon-TextFile>
                                            </div>
                                            <div class="mt-2 w-100 selected-file-name">
                                                <p>{{ UTRForm.controls['excelFile'].value.name }}</p>
                                            </div>
                                            <div class="mt-2">
                                                <button class="btn-browse"
                                                    (click)="clearFile('excelFile')">Clear</button>
                                            </div>
                                        </ng-container>
                                    </div>


                                </div>
                            </div>
                            <div class="col-12 col-md-6 col-lg-3 ">
                                <p class="text-secondary browse-file-title">PDF File</p>
                                <div class="mt-2">
                                    <div class="browse-file position-relative"
                                        [class.browse-file-error]="isUploadSubmitted && UTRForm.controls['pdffile'].errors">
                                        <ng-container *ngIf="!UTRForm.controls['pdffile'].value">
                                            <div class="d-flex justify-content-center align-items-center w-100">
                                                <icon-AddAttch></icon-AddAttch>
                                            </div>
                                            <div class="mt-2 w-100">
                                                <p>Drag & Drop Upload File</p>
                                            </div>
                                            <div class="mt-2">
                                                <button class="btn-browse">Browse File</button>
                                            </div>
                                            <input type="file" (change)="onFileChange($event, 'pdffile')" accept=".pdf"
                                                class="position-absolute top-0 left-0 h-100 w-100 opacity-0">
                                        </ng-container>
                                        <ng-container *ngIf=" UTRForm.controls['pdffile'].value">
                                            <div class="d-flex justify-content-center align-items-center w-100">
                                                <icon-Pdf></icon-Pdf>
                                            </div>
                                            <div class="mt-2 w-100 selected-file-name">
                                                <p>{{ UTRForm.controls['pdffile'].value.name }}</p>
                                            </div>
                                            <div class="mt-2">
                                                <button class="btn-browse" (click)="clearFile('pdffile')">Clear</button>
                                            </div>
                                        </ng-container>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </form>
                </div>

            </div>

            <div class="modal-footer popup-footer d-flex mt-4">
                <div class="d-flex justify-content-end gap-3">
                    <button class="btn btn-cancel p-footerbtns" (click)="closeUTRModal()">Cancel</button>
                    <button type="submit" class="btn btn-save p-footerbtns" (click)="uploadUTRDocument()">Save</button>
                </div>
            </div>
        </div>
    </div>
</div>