<div class="dashborad-main">
    <div class="container-fluid p-0">
        <div class="row m-4 mt-3 ms-0">
            <div class="col-12 ps-0">
                <!-- Breadcrumbs -->
                <app-breadcrumb></app-breadcrumb>
            </div>
        </div>
        <div class="row m-0 p-0 mb-4">
            <div class="col-12 m-0 p-0 board-header">
                <div class="d-flex justify-content-center flex-wrap gy-3 justify-content-md-between">
                    <div class=" board-title d-flex align-items-center">Group & Permissions</div>
                    <div class="btn btn-save text-center w-auto px-4 btn-assign d-flex justify-content-center align-items-center"
                        (click)="assingEmployee()">Assign to Employee
                    </div>
                </div>
            </div>
            <div class="col-12 mt-4">
                <div class="row">
                    <div class="col-12 p-0 col-lg-3">
                        <div class="row">
                            <div class="col-12">
                                <div class="add-group-btn text-center btn-h gap-1 d-flex justify-content-center align-items-center"
                                    (click)="addGroup()">
                                    <icon-Add></icon-Add>
                                    Add Group
                                </div>
                            </div>
                        </div>
                        <div class="row mt-4">
                            <div class="col-12">
                                <div class="grouptable-bg">
                                    <table class="addGroup-table border-0">
                                        <tr class=" border-bottom-0" style="cursor: pointer;">
                                            <td class="d-flex justify-content-between mb-3"
                                                *ngFor="let item of groupList"
                                                [ngClass]="{'active':selectedGroup === item.id}"
                                                (click)="groupClick(item)">
                                                <!-- active -->
                                                <p>{{item.groupName}}</p>
                                                <div class="action-icons">
                                                    <span (click)="editGroup(item);  $event.stopPropagation()"
                                                        mat-raised-button matTooltip="Edit"
                                                        [matTooltipPosition]="'left'"
                                                        [matTooltipShowDelay]="showDelay.value"
                                                        [matTooltipHideDelay]="hideDelay.value" aria-label="Edit"
                                                        class="user-group me-1">
                                                        <icon-UserGroup></icon-UserGroup>
                                                    </span>
                                                    <span class="del-group"
                                                        (click)="onDeleteGroup(item);  $event.stopPropagation()"
                                                        mat-raised-button matTooltip="Delete"
                                                        [matTooltipPosition]="'right'"
                                                        [matTooltipShowDelay]="showDelay.value"
                                                        [matTooltipHideDelay]="hideDelay.value" aria-label="Delete">
                                                        <icon-delete></icon-delete>
                                                    </span>
                                                </div>
                                            </td>
                                        </tr>
                                    </table>
                                </div>
                            </div>
                        </div>
                    </div>
                    <div class="col-12 col-lg-9 p-0 mt-4 mt-lg-0 ps-lg-4">
                        <div class="row">
                            <div class="col-12">
                                <div class="screen-title">
                                    <h5 class="fw-medium">Screen Access</h5>
                                </div>
                            </div>
                        </div>
                        <div class="row mt-4">
                            <div class="col-12">
                                <div class="screen-table table-responsive">
                                    <table class="table mb-0 ">
                                        <tr class="d-flex justify-content-between screentabletitle">
                                            <th class="fw-medium"> {{selectedGroupName}} Menu Screens </th>
                                            <th class="fw-medium">Permissions</th>
                                        </tr>
                                        <div class="manage_table ">
                                            <tr class="d-flex justify-content-between cursor"
                                                [ngClass]="{'active-tr': selectedMenu === screen.screenId}"
                                                *ngFor="let screen of screenPermissionsList">
                                                <td (click)="getScreenSubMenuList(screen)">
                                                    {{screen.screenName }}
                                                </td>
                                                <td class="pe-5">
                                                    <label class="toggle-btn">
                                                        <input type="checkbox" [(ngModel)]="screen.isPermission"
                                                            (change)="onSwitchChange(screen, $event)">
                                                        <span [class.bg-toggle-on]="screen.isPermission"
                                                            [class.bg-toggle-off]="!screen.isPermission"></span>
                                                    </label>
                                                </td>
                                            </tr>
                                        </div>
                                    </table>
                                </div>
                            </div>
                        </div>
                        <div class="row mt-4">
                            <div class="col-12">
                                <div #tableContainer
                                    class="table-responsive screen-table screen-permissiontable w-100 ">
                                    <table class="w-100 table mb-0">
                                        <thead class="screentabletitle position-sticky top-0 z-3">
                                            <tr class="w-100">
                                                <th class="w-26 fw-medium">{{selectedMenuName}} Permissions</th>
                                                <th class="text-center w-20 fw-medium"
                                                    *ngFor="let item of permissionList">
                                                    {{item.permissionType}}</th>
                                            </tr>
                                        </thead>
                                        <tbody class="height-manage">
                                            <tr class=" d-flex justify-content-between w-100"
                                                *ngFor="let screen of subMenuList ; index as i">
                                                <td class="w-26">{{
                                                    screen.subMenuName
                                                    }}</td>
                                                <td class="text-center w-20" *ngFor=" let permission of permissionList">
                                                    <div class="d-flex justify-content-center align-items-center">
                                                        <ng-container>
                                                            <mat-checkbox class="example-margin "
                                                                [checked]="isCheckboxChecked(screen.menuPermissions, permission.id)"
                                                                [disabled]="!isSelectedMenu"
                                                                (change)="onCheckBoxChange(screen,permission, $event,i)" />
                                                        </ng-container>
                                                    </div>
                                                </td>
                                            </tr>
                                        </tbody>
                                    </table>
                                    <div
                                        class="table-footer py-3 px-3 bg-white position-sticky w-100 bottom-0 left-0 border-top d-flex justify-content-end">
                                        <button type="submit" class="header-btn btn-save checks"
                                            (click)="submitPermission()">
                                            <p class=" py-1">Save</p>
                                            <icon-Save></icon-Save>
                                        </button>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>


<div bsModal #groupModel="bs-modal" class="modal fade" tabindex="-1" aria-labelledby="exampleModalLabel"
    data-backdrop="static" data-bs-keyboard="false" aria-hidden="true">
    <div class="modal-dialog popup-design">
        <div class="modal-content px-4">
            <div class="modal-header popup-header justify-content-between d-flex">
                <h5 class="modal-title pt-2" id="exampleModalLabel">Add Group</h5>
                <span class="d-block" (click)="closeModel()">
                    <icon-ModalClose></icon-ModalClose>
                </span>
            </div>
            <form #formDirective="ngForm" [formGroup]="groupForm" (ngSubmit)="postGroup()" novalidate>
                <div class="modal-body bg-white pt-4 pb-3">
                    <div class="w-100 ">
                        <mat-form-field appearance="outline" class="w-100 custom-mat-form-field">
                            <mat-label>Group Name</mat-label>
                            <input matInput placeholder="Group Name" formControlName="groupName" name="groupName"
                                required>

                        </mat-form-field>
                    </div>
                    <div class="w-100 mt-2 mb-2">
                        <mat-form-field appearance="outline" class="w-100">
                            <mat-label>Description</mat-label>
                            <textarea matInput name="description" required rows="3" placeholder="Description"
                                formControlName="description" name="description"></textarea>

                        </mat-form-field>
                    </div>
                </div>
                <div class="modal-footer d-flex justify-content-end align-items-end">
                    <button type="submit" class="btn btn-save p-footerbtns p-4 py-2">Save</button>
                </div>
            </form>
        </div>
    </div>
</div>