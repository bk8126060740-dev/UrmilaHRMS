<div class="dashborad-main payment-report">
    <div class="container-fulid p-0">
        <div class="row">
            <div class="col-12">
                <app-breadcrumb></app-breadcrumb>
            </div>
        </div>
        <div class="row m-0 mt-3 " *ngIf="!isHistoryData">
            <div class="col p-0 m-0">
                <div class="main-board-1 pb-0 position-relative z-9">
                    <div
                        class="borad-header-create pb-3 pt-3 border-bottom d-flex justify-content-between position-sticky top-0 align-items-center cursor-pointer">
                        <p class="board-title">Contribution Report</p>
                        <div class="d-flex gap-3 ">
                            <div class="download-orders-container">
                                <button class="download-btn" (click)="toggleDropdown()">
                                    <span class="icon">üì•</span>
                                    Download Report Data
                                </button>
                                <div class="dropdown-panel" *ngIf="dropdownOpen" #dropdownPanel>
                                    <div class="info-box">
                                        <span class="info-icon">‚ÑπÔ∏è</span>
                                        Download Requested Report File
                                    </div>
                                    <div class="exported-files-title">EXPORTED FILES</div>
                                    <div class="exported-files-list">
                                        <div class="exported-file" *ngFor="let file of exportedFiles">
                                            <div class="file-info">
                                                <div class="file-name">{{ file.name }}</div>
                                                <div class="file-date">{{ file.createdDate | date:'dd MMM yyyy, hh:mm a'
                                                    }}</div>
                                            </div>
                                            <a class="download-link" [href]="file.reportFilePath" download
                                                *ngIf="file.reportFilePath != null && file.reportFilePath != ''">
                                                <span class="download-icon">‚¨áÔ∏è</span> Download
                                            </a>
                                            <a class="download-link"
                                                *ngIf="file.reportFilePath === null || file.reportFilePath === ''">
                                                <span class="download-icon">üîÑ</span> Processing
                                            </a>
                                        </div>
                                    </div>
                                </div>
                            </div>
                            <button type="submit" class="header-btn btn-cancel" (click)="onCancel()">
                                <p>Cancel</p><svg xmlns="http://www.w3.org/2000/svg" width="1em" height="1em"
                                    viewBox="0 0 24 24" class="d-none ng-star-inserted">
                                    <path fill="currentColor"
                                        d="M18.3 5.71a.996.996 0 0 0-1.41 0L12 10.59L7.11 5.7A.996.996 0 1 0 5.7 7.11L10.59 12L5.7 16.89a.996.996 0 1 0 1.41 1.41L12 13.41l4.89 4.89a.996.996 0 1 0 1.41-1.41L13.41 12l4.89-4.89c.38-.38.38-1.02 0-1.4">
                                    </path>
                                </svg><!--container-->
                            </button>
                            <button type="submit" class="header-btn btn-save" (click)="onGenerate()">
                                <p>Generate</p><svg xmlns="http://www.w3.org/2000/svg" width="1em" height="1em"
                                    viewBox="0 0 24 24" class="d-none ng-star-inserted">
                                    <path fill="currentColor"
                                        d="M9.84 17.08a1 1 0 0 1-.707-.293l-3.84-3.84a1 1 0 1 1 1.414-1.414l3.133 3.133l7.453-7.453a1 1 0 0 1 1.414 1.414l-8.16 8.16a1 1 0 0 1-.707.293">
                                    </path>
                                </svg><!--container-->
                            </button>
                        </div>
                    </div>
                    <div class="borad-body p-4">

                        <!-- Form Details -->
                        <form [formGroup]="pfContributionReportForm">
                            <div class="row gy-3">
                                <div class="col-md-6 col-12">
                                    <ng-select [items]="clientList" bindLabel="text" bindValue="value"
                                        [class.ng-select-unselected]="isViewMode && pfContributionReportForm.controls['selectedClientId'].errors"
                                        formControlName="selectedClientId" placeholder="Select Client *"
                                        (change)="onClientChange()" required [clearable]="false">
                                    </ng-select>
                                </div>
                                <div class="col-md-6 col-12">
                                    <ng-select [items]="projectList" bindLabel="name" bindValue="id"
                                        [class.ng-select-unselected]="isViewMode && pfContributionReportForm.controls['selectedProjectId'].errors"
                                        formControlName="selectedProjectId" [clearable]="false"
                                        placeholder="Select Project *" required>
                                    </ng-select>
                                </div>
                            </div>
                            <div class="row gy-3 mt-1">
                                <div class="col-xl-3 col-lg-6 col-12">
                                    <ng-select bindLabel="shortName" bindValue="id" formControlName="selectedMonth"
                                        [class.ng-select-unselected]="isViewMode && pfContributionReportForm.controls['selectedMonth'].errors"
                                        [items]="monthList" [clearable]="false" placeholder="Select Month *" required>
                                    </ng-select>
                                </div>
                                <div class="col-xl-3 col-lg-6 col-12">
                                    <ng-select bindLabel="text" bindValue="value" formControlName="selectedYear"
                                        [class.ng-select-unselected]="isViewMode && pfContributionReportForm.controls['selectedYear'].errors"
                                        [items]="yearList" [clearable]="false" placeholder="Select Year *" required>
                                    </ng-select>
                                </div>
                                <div class="col-xl-3 col-lg-6 col-12">
                                    <ng-select bindLabel="text" bindValue="id" formControlName="selectedNegative"
                                        [items]="typeList" [clearable]="false" placeholder="Negative">
                                    </ng-select>
                                </div>
                                <div class="col-xl-3 col-lg-6 col-12">
                                    <ng-select bindLabel="text" bindValue="id" formControlName="selectedType"
                                        [class.ng-select-unselected]="isViewMode && pfContributionReportForm.controls['selectedType'].errors"
                                        placeholder="Select Type *" [items]="exportTypeList" required
                                        [clearable]="false">
                                    </ng-select>
                                </div>
                            </div>
                        </form>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

<div class="table-container m-4">
    <div class="table-responsive">
        <table class="table table-hover compliance-table">
            <thead>
                <tr>
                    <th colspan="4" class="text-center" style="border-left: transparent !important;">Project Data</th>
                    <th colspan="3" class="text-center">Invoice Data</th>
                    <th colspan="3" class="text-center">Employee Data</th>
                    <th class="text-center">Attendance</th>
                    <th colspan="3" class="text-center">Wages</th>
                    <th colspan="3" class="text-center">IP Contribution</th>
                    <th class="text-center">Status</th>
                    <th colspan="4" class="text-center" style="border-right: transparent !important;">Action</th>
                </tr>
                <tr>
                    <th class="text-center" style="border-left: transparent !important;">Project Name</th>
                    <th class="text-center">State Name</th>
                    <th class="text-center">District</th>
                    <th class="text-center">Location</th>
                    <th class="text-center">Period</th>
                    <th class="text-center">Invoice No</th>
                    <th class="text-center">Invoice Date</th>
                    <th class="text-center">Employee Id</th>
                    <th class="text-center">Employee Name</th>
                    <th class="text-center">ESIC No</th>
                    <th class="text-center">Working Days</th>
                    <th class="text-center">Total Wages</th>
                    <th class="text-center">Department</th>
                    <th class="text-center">Difference</th>
                    <th class="text-center">IP Contribution</th>
                    <th class="text-center">Department</th>
                    <th class="text-center">Difference</th>
                    <th class="text-center">Difference </th>
                    <th class="text-center">Challan</th>
                    <th class="text-center" style="border-right: transparent !important;">ECR</th>

                </tr>
            </thead>
            <tbody>
                <tr *ngFor="let row of rowData">
                    <td class="text-center">{{ row.projectName }}</td>
                    <td class="text-center">{{ row['State Name'] }}</td>
                    <td class="text-center">{{ row.District }}</td>
                    <td class="text-center">{{ row.location }}</td>
                    <td class="text-center">{{ row.period }}</td>
                    <td class="text-center">{{ row.invoiceNo }}</td>
                    <td class="text-center">{{ row.invoiceDate }}</td>
                    <td class="text-center">{{ row.employeeCode }}</td>
                    <td class="text-center">{{ row.employeeName }}</td>
                    <td class="text-center">{{ row.esicNo }}</td>
                    <td class="text-center">{{ row.presentDays }}</td>
                    <td class="text-center">{{ row.grossWages }}</td>
                    <td class="text-center">{{ row.deptTotalWages }}</td>
                    <td class="text-center">{{ row.diffTotalWages }}</td>
                    <td class="text-center">{{ row.calC_IP_Contribution }}</td>
                    <td class="text-center">{{ row.depT_IP_Contribution }}</td>
                    <td class="text-center">{{ row.difference_IP_Contribution }}</td>

                    <td class="text-center">{{ row.status }}</td>
                    <td class="text-center">
                        <button class="btn btn-link" (click)="downloadFile(row,'ESIC Challan')"
                            *ngIf="row.status == 'Deposited'">
                            <span class="icn-bg bg-skyblue" mat-raised-button mat-raised-button matTooltip="Download"
                                [matTooltipPosition]="'left'" [matTooltipShowDelay]="showDelay.value"
                                [matTooltipHideDelay]="hideDelay.value">
                                <icon-Download></icon-Download>
                            </span>
                        </button>
                    </td>
                    <td class="text-center">
                        <button class="btn btn-link" (click)="downloadFile(row,'ECR File')"
                            *ngIf="row.status == 'Deposited'">
                            <span class=" icn-bg bg-skyblue" mat-raised-button mat-raised-button matTooltip="Download"
                                [matTooltipPosition]="'left'" [matTooltipShowDelay]="showDelay.value"
                                [matTooltipHideDelay]="hideDelay.value">
                                <icon-Download></icon-Download>
                            </span>
                        </button>
                    </td>
                </tr>
                <tr *ngIf="rowData.length === 0">
                    <td colspan="22" class="text-center">No records found</td>
                </tr>
            </tbody>
        </table>
    </div>

    <!-- Pagination -->
    <div class="d-flex justify-content-between align-items-center mt-3 px-4 py-2 border-top">
        <div class="d-flex align-items-center">
            <!-- <span class="me-2">Records per page:</span> -->
            <select class="form-select form-select-sm" style="width: auto" [(ngModel)]="recordCount"
                (change)="onTotalRecoredChange(recordCount)">
                <option [value]="10">10</option>
                <option [value]="25">25</option>
                <option [value]="50">50</option>
                <option [value]="100">100</option>
            </select>
            <!-- <span class="ms-3">
                Showing {{ (pageNumber - 1) * recordCount + 1 }} to
                {{ Math.min(pageNumber * recordCount, totalCount) }} of {{ totalCount }} entries
            </span> -->
        </div>
        <nav aria-label="Page navigation">
            <ul class="pagination mb-0">

                <li class="page-item" [class.disabled]="pageNumber === 1">
                    <a class="page-link" href="javascript:void(0)" (click)="onPageChange(pageNumber - 1)"
                        [class.disabled]="pageNumber === 1">Previous</a>
                </li>
                <li class="page-item active">
                    <a class="page-link" href="javascript:void(0)">{{ pageNumber }}</a>
                </li>
                <!--  -->
                <li class="page-item" [class.disabled]="nextDisabled">
                    <a class="page-link" href="javascript:void(0)" (click)="onPageChange(pageNumber + 1)"
                        [class.disabled]="nextDisabled">Next</a>
                    <!-- [class.disabled]="pageNumber === getTotalPages()" -->
                </li>
            </ul>
        </nav>
    </div>
</div>